### Transaction Management & Analytics API Testing

@baseURL = http://localhost:4000/v1
@adminToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2ODk2MzBkYjI3Y2I3OWM0YTFiMzJjM2UiLCJlbWFpbCI6ImFkbWluQGdtYWlsLmNvbSIsInVzZXJUeXBlIjoiYWRtaW4iLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NTUxNzU4MTEsImV4cCI6MTc1NTI2MjIxMX0.hA6bDdt354l8vJDSsWLk8Hn_IzGKunAS-9cD3m5biDY
@userToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2ODkxZjUyODhiZmU2YjM3NDk0MDlkMzUiLCJlbWFpbCI6InVzZXJAZ21haWwuY29tIiwidXNlclR5cGUiOiJ1c2VyIiwicm9sZSI6InVzZXIiLCJpYXQiOjE3NTUxNzYwOTMsImV4cCI6MTc1NTI2MjQ5M30.UxcC5v9P62mVwnRTkZVWmzgrq5Hs0UC9SvWkq16odIE
@transactionId = TXN_1755176649375_FTB9TW

## ===========================
## ADMIN TRANSACTION MANAGEMENT
## ===========================

### Get All Transactions with Pagination
GET {{baseURL}}/admin/transactions?page=1&limit=20&sortBy=createdAt&sortOrder=desc
Authorization: Bearer {{adminToken}}

### Filter Transactions by Status
GET {{baseURL}}/admin/transactions?status=success&page=1&limit=10
Authorization: Bearer {{adminToken}}

### Filter by Payment Method
GET {{baseURL}}/admin/transactions?paymentMethod=card&page=1&limit=10
Authorization: Bearer {{adminToken}}

### Filter by Transaction Type
GET {{baseURL}}/admin/transactions?type=purchase&page=1&limit=10
Authorization: Bearer {{adminToken}}

### Filter by Date Range
GET {{baseURL}}/admin/transactions?startDate=2025-01-01&endDate=2025-12-31&page=1&limit=50
Authorization: Bearer {{adminToken}}

### Search Transactions by ID or Gateway ID
GET {{baseURL}}/admin/transactions?search=TXN_1234567890&page=1&limit=10
Authorization: Bearer {{adminToken}}

### Filter by User ID
GET {{baseURL}}/admin/transactions?userId=USER_ID_HERE&page=1&limit=10
Authorization: Bearer {{adminToken}}

### Filter by Subscription ID
GET {{baseURL}}/admin/transactions?subscriptionId=SUBSCRIPTION_ID_HERE&page=1&limit=10
Authorization: Bearer {{adminToken}}

### Get Transaction by ID (Detailed View)
GET {{baseURL}}/admin/transactions/{{transactionId}}
Authorization: Bearer {{adminToken}}

### Get Failed Transactions for Review
GET {{baseURL}}/admin/transactions/failed?page=1&limit=20
Authorization: Bearer {{adminToken}}

### Get Failed Transactions by Date Range
GET {{baseURL}}/admin/transactions/failed?startDate=2025-01-01&endDate=2025-01-31&page=1&limit=10
Authorization: Bearer {{adminToken}}

## ===========================
## REFUND MANAGEMENT
## ===========================

### Process Full Refund
POST {{baseURL}}/admin/transactions/{{transactionId}}/refund
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
    "reason": "Customer requested cancellation within 24 hours"
}

### Process Partial Refund
POST {{baseURL}}/admin/transactions/{{transactionId}}/refund
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
    "reason": "Service quality issue - partial refund approved",
    "amount": 150.00
}

### Process Refund for Technical Issue
POST {{baseURL}}/admin/transactions/{{transactionId}}/refund
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
    "reason": "Technical issue prevented service delivery",
    "amount": 299.00
}

## ===========================
## COMBINED ANALYTICS & DASHBOARD (New Single Endpoint)
## ===========================

### ⭐ Get Complete Transaction Statistics (Replaces all analytics endpoints)
GET {{baseURL}}/admin/transactions/stats
Authorization: Bearer {{adminToken}}

### Get Stats with Date Range (All dates in IST timezone)
GET {{baseURL}}/admin/transactions/stats?startDate=2025-01-01&endDate=2025-01-31
Authorization: Bearer {{adminToken}}

### Get Daily Analytics Breakdown
GET {{baseURL}}/admin/transactions/stats?startDate=2025-01-01&endDate=2025-01-31&groupBy=day
Authorization: Bearer {{adminToken}}

### Get Weekly Analytics Breakdown
GET {{baseURL}}/admin/transactions/stats?startDate=2025-01-01&endDate=2025-03-31&groupBy=week
Authorization: Bearer {{adminToken}}

### Get Monthly Analytics Breakdown
GET {{baseURL}}/admin/transactions/stats?startDate=2025-01-01&endDate=2025-12-31&groupBy=month
Authorization: Bearer {{adminToken}}

### ❌ REMOVED ENDPOINTS (Use /admin/transactions/stats instead):
### - GET /admin/analytics/dashboard
### - GET /admin/analytics/revenue  
### - GET /admin/analytics/payment-methods

## ===========================
## DATA EXPORT
## ===========================

### Export All Transactions (JSON)
GET {{baseURL}}/admin/transactions/export
Authorization: Bearer {{adminToken}}

### Export Successful Transactions Only
GET {{baseURL}}/admin/transactions/export?status=success
Authorization: Bearer {{adminToken}}

### Export Transactions by Date Range
GET {{baseURL}}/admin/transactions/export?startDate=2025-01-01&endDate=2025-01-31
Authorization: Bearer {{adminToken}}

### Export Transactions as CSV
GET {{baseURL}}/admin/transactions/export?format=csv&startDate=2025-01-01&endDate=2025-01-31
Authorization: Bearer {{adminToken}}

### Export Failed Transactions for Analysis
GET {{baseURL}}/admin/transactions/export?status=failed&format=csv
Authorization: Bearer {{adminToken}}

## ===========================
## USER TRANSACTION HISTORY
## ===========================

### Get User's Transaction History
GET {{baseURL}}/my-transactions?page=1&limit=15
Authorization: Bearer {{userToken}}

### Get User's Successful Transactions
GET {{baseURL}}/my-transactions?status=success&page=1&limit=10
Authorization: Bearer {{userToken}}

### Get User's Failed Transactions
GET {{baseURL}}/my-transactions?status=failed&page=1&limit=10
Authorization: Bearer {{userToken}}

### Get User's Transactions by Date Range
GET {{baseURL}}/my-transactions?startDate=2025-01-01&endDate=2025-03-31&page=1&limit=20
Authorization: Bearer {{userToken}}

### Get User's Purchase History Only
GET {{baseURL}}/my-transactions?type=purchase&page=1&limit=10
Authorization: Bearer {{userToken}}

### Get User's Refund History
GET {{baseURL}}/my-transactions?type=refund&page=1&limit=10
Authorization: Bearer {{userToken}}

## ===========================
## REAL-TIME MONITORING
## ===========================

### Get Recent Transactions (Last 24 hours)
GET {{baseURL}}/admin/transactions?startDate={{$datetime rfc1123 -1 d}}&page=1&limit=50
Authorization: Bearer {{adminToken}}

### Get Pending Transactions (Need Attention)
GET {{baseURL}}/admin/transactions?status=pending&page=1&limit=20
Authorization: Bearer {{adminToken}}

### Get High-Value Transactions (Amount > ₹1000)
GET {{baseURL}}/admin/transactions?page=1&limit=20&sortBy=finalAmount&sortOrder=desc
Authorization: Bearer {{adminToken}}

## ===========================
## CUSTOMER INSIGHTS
## ===========================

### Get Top Spending Users (via Transaction Analysis)
GET {{baseURL}}/admin/transactions?page=1&limit=100&sortBy=finalAmount&sortOrder=desc
Authorization: Bearer {{adminToken}}

### Get Most Active Users (by Transaction Count)
GET {{baseURL}}/admin/transactions?page=1&limit=200&sortBy=createdAt&sortOrder=desc
Authorization: Bearer {{adminToken}}

### Analyze Payment Method Preferences
GET {{baseURL}}/admin/analytics/payment-methods?startDate={{$datetime iso8601 -90 d}}&endDate={{$datetime iso8601}}
Authorization: Bearer {{adminToken}}

## ===========================
## WEBHOOK TESTING
## ===========================

### Test Webhook - Payment Captured
POST {{baseURL}}/purchase/webhook
Content-Type: application/json
X-Razorpay-Signature: valid_webhook_signature

{
    "entity": "event",
    "account_id": "acc_ACCOUNT_ID",
    "event": "payment.captured",
    "contains": ["payment"],
    "payload": {
        "payment": {
            "entity": {
                "id": "pay_PAYMENT_ID",
                "entity": "payment",
                "amount": 29900,
                "currency": "INR",
                "status": "captured",
                "order_id": "order_ORDER_ID",
                "method": "card",
                "captured": true,
                "created_at": 1643723389
            }
        }
    },
    "created_at": 1643723389
}

### Test Webhook - Payment Failed
POST {{baseURL}}/purchase/webhook
Content-Type: application/json
X-Razorpay-Signature: valid_webhook_signature

{
    "entity": "event",
    "account_id": "acc_ACCOUNT_ID",
    "event": "payment.failed",
    "contains": ["payment"],
    "payload": {
        "payment": {
            "entity": {
                "id": "pay_FAILED_PAYMENT_ID",
                "entity": "payment",
                "amount": 29900,
                "currency": "INR",
                "status": "failed",
                "order_id": "order_ORDER_ID",
                "method": "card",
                "error_description": "Payment processing failed",
                "created_at": 1643723389
            }
        }
    },
    "created_at": 1643723389
}

### Test Webhook - Refund Processed
POST {{baseURL}}/purchase/webhook
Content-Type: application/json
X-Razorpay-Signature: valid_webhook_signature

{
    "entity": "event",
    "account_id": "acc_ACCOUNT_ID",
    "event": "refund.processed",
    "contains": ["refund"],
    "payload": {
        "refund": {
            "entity": {
                "id": "rfnd_REFUND_ID",
                "entity": "refund",
                "amount": 29900,
                "currency": "INR",
                "payment_id": "pay_PAYMENT_ID",
                "status": "processed",
                "created_at": 1643723389
            }
        }
    },
    "created_at": 1643723389
}