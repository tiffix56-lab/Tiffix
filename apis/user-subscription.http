### Subscription Purchase & Management API Testing

# Base URL
@baseURL = http://localhost:4000/v1
@adminToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2ODk2MzBkYjI3Y2I3OWM0YTFiMzJjM2UiLCJlbWFpbCI6ImFkbWluQGdtYWlsLmNvbSIsInVzZXJUeXBlIjoiYWRtaW4iLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NTUxNzU4MTEsImV4cCI6MTc1NTI2MjIxMX0.hA6bDdt354l8vJDSsWLk8Hn_IzGKunAS-9cD3m5biDY
@userToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2ODllMmE1ZTI2NzQyODAwODMyMjA0NGMiLCJlbWFpbCI6InVzZXJAZ21haWwuY29tIiwidXNlclR5cGUiOiJ1c2VyIiwicm9sZSI6InVzZXIiLCJpYXQiOjE3NTY0ODg5MTIsImV4cCI6MTc1NjU3NTMxMn0.ypPz0vnNm88NSKocreRMliVswuz-4tjQjsPl02BoOKc
@subscriptionId = 68b2ba105d778fa67180c131
@userSubscriptionId = 689247b921ca814950b20380
@transactionId = TXN_1755176666817_2DHJPO
@deliveryZoneId = 689e2aec2674280083220470
@promoCode = WELCOME50
@razorpayOrderId = order_689247b921ca814950b20382
@razorpayPaymentId = pay_689247b921ca814950b20383
@razorpaySignature = sig_689247b921ca814950b20384

## ===========================
## SUBSCRIPTION PURCHASE FLOW
## ===========================

### Purchase a Subscription without Promo Code (User)
POST {{baseURL}}/subscription-purchase/initiate
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "subscriptionId": "{{subscriptionId}}",
  # "deliveryZoneId": "{{deliveryZoneId}}",
  # "billingAddress": {
  #   "street": "123 Main St",
  #   "city": "Mumbai",
  #   "state": "Maharashtra",
  #   "country": "India",
  #   "postalCode": "400001"
  # },
  "deliveryAddress": {
    "street": "456 Elm St",
    "city": "Mumbai",
    "state": "Maharashtra",
    "country": "India",
    "zipCode": "122018",
    "coordinates": {
      "type": "Point",
      "coordinates": [28.402926, 77.048365]
    }
  },
  "mealTimings": {
    "lunch": {
      "enabled": true,
      "time": "12:30"
    },
    "dinner": {
      "enabled": true,
      "time": "19:30"
    }
  },
  "startDate": "2025-08-31"
}

### Purchase a Subscription with Promo Code (User)
POST {{baseURL}}/subscriptions/purchase
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "subscriptionId": "{{subscriptionId}}",
  "promoCode": "{{promoCode}}",
  "deliveryZoneId": "{{deliveryZoneId}}",
  "billingAddress": {
    "street": "123 Main St",
    "city": "Mumbai",
    "state": "Maharashtra",
    "country": "India",
    "postalCode": "400001"
  },
  "deliveryAddress": {
    "street": "789 Pine St",
    "city": "Mumbai",
    "state": "Maharashtra",
    "country": "India",
    "postalCode": "400002",
    "coordinates": {
      "type": "Point",
      "coordinates": [72.8777, 19.0760]
    }
  },
  "mealTimings": {
    "lunch": {
      "enabled": true,
      "time": "13:00"
    },
    "dinner": {
      "enabled": true,
      "time": "20:00"
    }
  },
  "startDate": "2025-08-24"
}

### Verify Payment for Subscription Purchase (User)
POST {{baseURL}}/subscriptions/verify-payment
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "razorpay_order_id": "{{razorpayOrderId}}",
  "razorpay_payment_id": "{{razorpayPaymentId}}",
  "razorpay_signature": "{{razorpaySignature}}",
  "userSubscriptionId": "{{userSubscriptionId}}"
}

### Get User Subscription Details (User)
GET {{baseURL}}/subscriptions/me/{{userSubscriptionId}}
Content-Type: application/json
Authorization: Bearer {{userToken}}

### Update Subscription Preferences (User)
PATCH {{baseURL}}/subscriptions/me/{{userSubscriptionId}}/preferences
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "deliveryPreferences": {
    "preferredDeliveryTime": "evening",
    "deliveryInstructions": "Leave at doorstep if not available"
  },
  "autoRenew": false
}

### Cancel Subscription (User)
PATCH {{baseURL}}/subscriptions/me/{{userSubscriptionId}}/cancel
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "cancellationReason": "No longer needed"
}

### Request Vendor Switch (User)
POST {{baseURL}}/subscriptions/me/{{userSubscriptionId}}/vendor-switch
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "reason": "Unsatisfactory vendor service",
  "preferredVendorId": null
}

## ===========================
## ADMIN SUBSCRIPTION MANAGEMENT
## ===========================

### Get All User Subscriptions (Admin)
GET {{baseURL}}/admin/subscriptions?page=1&limit=10&status=active&sortBy=startDate&sortOrder=desc&category=home_chef
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### Get User Subscription Details by ID (Admin)
GET {{baseURL}}/admin/subscriptions/{{userSubscriptionId}}
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### Get User Subscription Analytics (Admin)
GET {{baseURL}}/admin/subscriptions/analytics?startDate=2025-08-01&endDate=2025-08-23
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### Update User Subscription Status (Admin)
PATCH {{baseURL}}/admin/subscriptions/{{userSubscriptionId}}/status
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "status": "paused",
  "adminNotes": "Paused due to payment issues"
}