### Subscription Purchase & Management API Testing

# Base URL
@baseURL = http://localhost:4000/v1
@accessToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OGIzMzI2OWUxZTUwZWJlNmY0ZDZkYTkiLCJlbWFpbCI6InVzZXIyQGdtYWlsLmNvbSIsInVzZXJUeXBlIjoidXNlciIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNzU2NzUwNzQ4LCJleHAiOjE3NTY4MzcxNDh9.RDaispXIISeoZzAakuZJfyo5ISr4_pE1ZuoYp83du00
@adminToken = ""
@userSubscriptionId=""

### ============== SUBSCRIPTION PURCHASE & MANAGEMENT APIs ==============

### Initiate Subscription Purchase (Requires Authentication) - Razorpay Integration
# Response will include razorpayKeyId and razorpayOrderId for frontend integration
POST {{baseURL}}/subscription-purchase/initiate
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "subscriptionId": "68b2ba105d778fa67180c131",

  "deliveryAddress": {
    "street": "789 Pine St",
    "city": "Mumbai",
    "state": "Maharashtra",
    "country": "India",
    "postalCode": "400002",
    "coordinates": {
      "type": "Point",
      "coordinates": [72.8777, 19.0760]
    }
  },
  "mealTimings": {
    "lunch": {
      "enabled": true,
      "time": "13:00"
    },
    "dinner": {
      "enabled": true,
      "time": "20:00"
    }
  },
  "startDate": "2025-09-02T00:00:00.000Z"
}

### Verify Payment (Requires Authentication) - Razorpay Integration
POST {{baseURL}}/subscription-purchase/verify-payment
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "razorpay_order_id": "order_PQ7zxJgkzpQ1eF",
  "razorpay_payment_id": "pay_PQ7zxJgkzpQ1eF",
  "razorpay_signature": "9ef4dffbfd84f1318f6739dcbdf764f68a8dc5e8c61d8d1c2e5f5b0e1d2c6d5a",
  "userSubscriptionId": "68b5e59b5b07d1ce6123bbdd"
}

### Get My Subscriptions (Requires Authentication)
GET {{baseURL}}/my-subscriptions?page=1&limit=10&status=active
Authorization: Bearer {{accessToken}}

### Get My Subscriptions with Filters
GET {{baseURL}}/my-subscriptions?page=1&limit=5&status=active&category=home_chef&startDate=2024-01-01&endDate=2024-12-31
Authorization: Bearer {{accessToken}}

### Get Subscription by ID (Requires Authentication)
GET {{baseURL}}/my-subscriptions/68b33354927d9f0b0616a84b
Authorization: Bearer {{accessToken}}

### Cancel Subscription (Requires Authentication)
POST {{baseURL}}/my-subscriptions/68b33354927d9f0b0616a84b/cancel
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "cancellationReason": "No longer needed"
}

### Request Vendor Switch (Requires Authentication)
POST {{baseURL}}/my-subscriptions/68b33354927d9f0b0616a84b/request-vendor-switch
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "reason": "Unsatisfactory vendor service",
  "preferredVendorId": null
}

## ===========================
## ADMIN SUBSCRIPTION MANAGEMENT
## ===========================

### Get All User Subscriptions (Admin)
GET {{baseURL}}/admin/subscriptions?page=1&limit=10&status=active&sortBy=startDate&sortOrder=desc&category=home_chef
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### Get User Subscription Details by ID (Admin)
GET {{baseURL}}/admin/subscriptions/{{userSubscriptionId}}
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### Get User Subscription Analytics (Admin)
GET {{baseURL}}/admin/subscriptions/analytics?startDate=2025-08-01&endDate=2025-08-23
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### Update User Subscription Status (Admin)
PATCH {{baseURL}}/admin/subscriptions/{{userSubscriptionId}}/status
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "status": "paused",
  "adminNotes": "Paused due to payment issues"
}

### ============== RAZORPAY WEBHOOK ENDPOINTS (FOR TESTING) ==============

### Razorpay Payment Webhook (No Authentication Required)
POST {{baseURL}}/payments/razorpay/webhook
Content-Type: application/json
X-Razorpay-Signature: t=1234567890,v1=sha256_hash_signature

{
  "entity": "event",
  "account_id": "acc_BFQ7uQEaa30PNt",
  "event": "payment.captured",
  "contains": ["payment"],
  "payload": {
    "payment": {
      "entity": {
        "id": "pay_29QQoUBi66xm2f",
        "entity": "payment",
        "amount": 20000,
        "currency": "INR",
        "status": "captured",
        "order_id": "order_PQ7zxJgkzpQ1eF",
        "method": "card",
        "amount_refunded": 0,
        "refund_status": null,
        "captured": true,
        "description": "Subscription Purchase",
        "created_at": 1693564800
      }
    }
  },
  "created_at": 1693564805
}

